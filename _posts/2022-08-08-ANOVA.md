---
layout: post
title: "Analysis of Variance"
author: Cetus Li
date: 2022-08-08
---
#### **方差分析（Analysis of Variance，ANOVA）**
方差分析是一种通过分析方差来检验两个或多个均值之间差异的统计学方法。前面提到多个均值之间的差异比较可以用 Tukey HSD Test。
他们的特点：
- Tukey HSD Test 采用两两比较，计算量大但是结果具体。
- ANOVA 比较笼统，它假设所有均值都相等，零假设： $\mu_{1}$ = $\mu_{2}$ = ... = $\mu_{k}$ 被拒绝只能说明至少有一个均值不等于剩下的其中至少一个均值。这种非特异性零假设有时称为综合零假设（the omnibus null hypothesis）。
- 有些复杂的分析无法使用 Tukey HSD Test ，但可以使用 ANOVA。
- ANOVA 是目前最常用的比较均值方法。

#### **方差分析设计（Analysis of Variance Designs，ANOVA Designs）**
- 方差分析设计中的 Factors and Levels：Factor 就是自变量，Level 是自变量取值个数。
- 一个 Factor 的方差分析叫做 a one-way ANOVA，n 个 Factor 的方差分析叫做 a n-way ANOVA。
- Factor 根据每个 Level 是否对应同一个实验对象可以分为对象内因子（within-subjects factor）和对象间因子（between-subjects factor）。
- 因子设计（factorial design）举例：Gender (2) x Age (3)，括号里的数字是 Factor 的 Level。
- 复杂因子设计：Factor 数量大于等于 2，同时含有对象间因子和对象内因子。

#### **对象间单因子方差分析（One-Factor Between-Subjects ANOVA）**
**条件假设：**
1. 总体具有方差齐性， $\sigma ^{2}$ 。
2. 总体是正态分布。
3. 每个观测值都是独立的（因为是对象间设计）。

**分析过程：**
- Factor(k)：单因子 Factor 有 k 个 level。
- 方差分析的零假设 $H_{0}$ 为： $\mu_{1}$ = $\mu_{2}$ = ... = $\mu_{k}$ 。
- 从不同角度对总体方差 $\sigma^{2}$ 做两次估计，分别是 MSE 和 MSB。在零假设成立的情况下，MSE=MSB= $\sigma^{2}$ 。
- 不管各水平均值是否相等，MSE 都是对总体方差的估计，而 MSB 只在各水平均值相等时才是对总体方差的估计，若不等则 MSB 变大，均值之间差异越大，MSB 越大。
- 对 F=MSB/MSE 做 F 分布检验，若 p 达到显著性水平则拒绝零假设，并得出结论：至少有一个均值不等于剩下的其中至少一个均值。
- F 分布的形状由样本大小决定，也就是 MSB 和 MSE 的自由度，分别是 k-1 和 N-k 。
- 因为 F 比值对任何原因引起的均值差异敏感，所有使用双尾检验。（有待理解）
- MSE 由各水平的方差计算而来，不需要假设方差齐性。MSE=( $S_{1}$ + $S_{2}$ +...+ $S_{k}$ )/k。
- MSB 由各水平的均值计算而来，需要假设方差齐性。MSB=n $S_{M}^{2}$ 。（因为抽样均值方差 $\sigma_{M}^{2}= \frac{\sigma^{2}}{n}$ ）
- n 是各水平的观测数，这里假设各水平观测数相同，总观测数 N=nk 。
- $S_{M}^{2} = \frac{(M_{1}- M_{M})^2+ (M_{2}- M_{M})^2 +...+ (M_{k}- M_{M})^2}{k-1}$ ， $M_{M}=\frac{M_{1}+M_{2}+...+M_{k}}{k}$ 。
- 只比较两个独立均值差异时， F 检验和 t 检验结果相同，自由度也相同。 

**方差分析原理：**
- ANOVA 的一个重要特点是将数据偏离均值的`变异(sum of squares，SSQ)` 分为不同来源。
- 总变异 $SSQ_{total} = \Sigma (X-GM)^2$  。GM，the grand mean，是所有观测对象的均值。
- 被因子的实验条件（level）解释的变异 $SSQ_{condition} = \Sigma_{1}^{k} n_{1}(M_{1}-GM)^2$ 。 $n_{1},M_{1}$ 分别是条件 1 下的观测对象个数和均值。
- 未被测量的不明原因综合引起的误差变异 $SSQ_{error} = \Sigma(X_{i1}-M_{1})^2+\Sigma(X_{i2}-M_{2})^2+...+\Sigma(X_{ik}-M_{k})^2$ ，也就是各个条件内部的方差和相加。
- $SSQ_{total} = SSQ_{condition} + SSQ_{error}$ 。
- $MSB = SSQ_{condition}/dfn$ 。dfn，the degrees of freedom numerator，分子的自由度，dfn=k-1。
- $MSE = SSQ_{error}/dfd$ 。dfd，the degrees of freedom for the denominator，分母的自由度，有时也叫 dfe，degrees of freedom error，dfd=dfe=N-k。
- F=MSB/MSE 比值出现在一个自由度为（dfn,dfd）且 MSB=MSE 本应该相等的实验中的概率 p 如果小于显著性水平则认为 MSB!=MSE 是一个合理的结论。

#### **对象间多因子方差分析（Multi-Factor Between-Subjects Designs）**
在同一个实验中包含多个因子除了提高效率（相对于针对每个因子设计一个实验），还可以检验因子之间的相互作用。含有双因子的实验 A(m) x B(n)，具有 m $\times$ n 个实验条件。

**主效应与简单效应（Main Effect and Simple Effect）**
- 一个因子的 Main Effect 是指它的 Marginal Means 之间的差异，也就是自己不同水平间的差异。一个因子的一个水平对应一个 Marginal Mean（边际平均数）， Marginal Mean 等于该水平下其他因子所有水平均值的平均值。
- 一个因子的 Simple Effect 是指在其他因子的一个具体水平下，该因子自己不同水平之间的差异。
- 当一个因子的效应因第二个因子的水平不同而不同时，他们之间存在相互作用，也就是一个因子的 Simple Effect 在第二个因子的不同水平下发生显著改变，说明它们之间存在相互作用。
- **方差分析被用来检验主效应和交互作用的显著性。**

**方差分析汇总表（ANOVA Summary Table）之变异来源和自由度**
- 变异来源有这几项：各因子，因子交互，Error。*如果每个实验条件的样本数目相等，那么这里的各项变异之和等于 Total 项变异。*
- 一个因子的主效应的自由度永远等于该因子 level 数减 1 。
- 因子交互的自由度等于交互的因子的自由度的乘积。
- Error 项的自由度等于总观测数减去总实验条件数，实验条件数等于各因子的水平数乘积。
- Total 项的自由度等于总观测数减 1，同时也等于以上各项自由度之和。
- 每一项的 MS 等于变异除以自由度，每一项的 F 比值等于自己的 MS 比上 Error 项的 MS，由 F 比值判断该项的效应是否显著。






-------
#### **题外话**
MSB/MSE 比值是根据统计学家 R. Fisher 命名为 F 比值。
